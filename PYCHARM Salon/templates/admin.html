<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | Manage Appointments</title>
<link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
</head>
<body>

<header>
    <h1>Admin Dashboard</h1>

    <div>
        <a href="{{ url_for('admin_users') }}" class="logout-btn" style="background:#6a1b9a;">Users</a>
        <a href="{{ url_for('admin_reviews') }}" class="logout-btn" style="background:#6a1b9a;">Reviews</a>
        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
    </div>
</header>

<main>
    <section class="appointments">
        <h2>Manage Appointments</h2>

        <div class="filters" style="margin-bottom: 20px; font-size: 1.1em;">
            Filter Status:
            <a href="{{ url_for('admin_dashboard', status='All') }}" style="margin-right: 15px; font-weight: {{ 'bold' if current_filter == 'All' else 'normal' }};">All</a>
            <a href="{{ url_for('admin_dashboard', status='Upcoming') }}" style="margin-right: 15px; font-weight: {{ 'bold' if current_filter == 'Upcoming' else 'normal' }};">Upcoming</a>
            <a href="{{ url_for('admin_dashboard', status='Completed') }}" style="margin-right: 15px; font-weight: {{ 'bold' if current_filter == 'Completed' else 'normal' }};">Completed</a>
            <a href="{{ url_for('admin_dashboard', status='Cancelled') }}" style="margin-right: 15px; font-weight: {{ 'bold' if current_filter == 'Cancelled' else 'normal' }};">Cancelled</a>
        </div>
        <hr>

        {% if appointments %}
        <table>
            <thead>
                <tr>
                    <th>Customer Name</th>
                    <th>Phone</th>
                    <th>Gender</th>
                    <th>Appointment Time</th>
                    <th>Booked Services</th>
                    <th>Total Amount</th>
                    <th>Special Requests</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>

                {% for a in appointments %}
                <tr>
                    <td>{{ a.name }}</td>
                    <td>{{ a.phone }}</td>
                    <td>{{ a.gender }}</td>
                    <td>{{ a.appointment_time }}</td>

                    <td>
                        {% if a.cart %}
                            <ul style="list-style:none; padding-left:0;">
                            {% for item in a.cart %}
                                <li>{{ item.name }} - ₱{{ item.price }}</li>
                            {% endfor %}
                            </ul>
                        {% else %}
                            {{ a.service }}
                        {% endif %}
                    </td>

                    <td>₱{{ a.total }}</td>
                    <td>{{ a.message if a.message else 'None' }}</td>

                    <td>
                        <form method="POST" action="{{ url_for('admin_update_status') }}">
                            <input type="hidden" name="appointment_id" value="{{ a.id }}">
                            <select name="status" required>
                                <option value="Upcoming" {% if a.status=='Upcoming' %}selected{% endif %}>Upcoming</option>
                                <option value="Completed" {% if a.status=='Completed' %}selected{% endif %}>Completed</option>
                                <option value="Cancelled" {% if a.status=='Cancelled' %}selected{% endif %}>Cancelled</option>
                            </select>
                            <button type="submit" style="
                                margin-top:5px;
                                padding:5px 10px;
                                background:#9c4dcc;
                                color:white;
                                border:none;
                                border-radius:6px;
                                cursor:pointer;">
                                Update
                            </button>
                        </form>
                    </td>

                    <td>
                        <a href="{{ url_for('admin_delete_appointment', appointment_id=a.id) }}"
                           style="color: red; text-decoration: none; font-weight: bold;"
                           onclick="return confirm('Are you sure you want to delete this appointment?');">
                           Delete
                        </a>
                    </td>

                </tr>
                {% endfor %} </tbody>
        </table>

        {% else %}
            <p style="text-align:center; color:red;">
                No appointments found
                {% if current_filter != 'All' %}
                for status: **{{ current_filter }}**
                {% endif %}.
            </p>
        {% endif %}

    </section>
</main>

</body>
</html>